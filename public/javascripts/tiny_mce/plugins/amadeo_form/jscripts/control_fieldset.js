function initFieldset(){var inst=tinyMCE.getInstanceById(tinyMCE.getWindowArg('editor_id'));var fNode=inst.getFocusElement();var found=false;do{if(fNode.nodeName.toLowerCase()=="fieldset"){found=true;break;}}while(fNode=fNode.parentNode);if(found){editing=fNode;for(var i=0;i<editing.childNodes.length;i++){if(editing.childNodes[i].nodeName.toLowerCase()=='legend'){document.getElementById('ed_legend').value=encodeAttribute(editing.childNodes[i].innerHTML);break;}}document.getElementById('ed_name').value=editing.id.replace(/^fs_/,'');}else{editing=null;}}function insertFieldset(){var inst=tinyMCE.getInstanceById(tinyMCE.getWindowArg('editor_id'));var cName=document.getElementById('ed_name').value;if(cName==''){alert(tinyMCE.entityDecode(tinyMCE.getLang('lang_amadeo_form_err_name_mandatory')));return false;}else{cName='fs_'+cName;}inst.execCommand('mceBeginUndoLevel');if(editing){editing.setAttribute('id',cName);for(var i=0;i<editing.childNodes.length;i++){if(editing.childNodes[i].nodeName.toLowerCase()=='legend'){editing.childNodes[i].innerHTML=document.getElementById('ed_legend').value;break;}}}else{if(inst.selection.getSelectedHTML()){tinyMCEPopup.execCommand("mceInsertContent",false,'<fieldset '+makeAttrib('id',cName)+'><legend>'+document.getElementById('ed_legend').value+'</legend>'+inst.selection.getSelectedHTML()+'</fieldset>');}}inst.execCommand("mceEndUndoLevel");tinyMCEPopup.close();}